<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">

		<title> Kernel Upgrade - VMware Provider - Vagrant Documentation</title>

		<!-- meta -->
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<!-- lib styles -->
		<link href="../../stylesheets/bootstrap-2bdef9a2.css" tppabs="http://docs.vagrantup.com/stylesheets/bootstrap-2bdef9a2.css" media="screen" rel="stylesheet" type="text/css" />
<link href="../../stylesheets/vagrantup-71e7d178.css" tppabs="http://docs.vagrantup.com/stylesheets/vagrantup-71e7d178.css" media="screen" rel="stylesheet" type="text/css" />

		<!-- lib js -->
		<script src="../../javascripts/jquery-08c11650.js" tppabs="http://docs.vagrantup.com/javascripts/jquery-08c11650.js" type="text/javascript"></script>
		<script src="../../javascripts/modernizr-84c0465a.js" tppabs="http://docs.vagrantup.com/javascripts/modernizr-84c0465a.js" type="text/javascript"></script>
		<script src="../../javascripts/bootstrap.min-98cc7a22.js" tppabs="http://docs.vagrantup.com/javascripts/bootstrap.min-98cc7a22.js" type="text/javascript"></script>
		<script src="../../javascripts/backstretch-3d1212ad.js" tppabs="http://docs.vagrantup.com/javascripts/backstretch-3d1212ad.js" type="text/javascript"></script>
		<script src="../../javascripts/vagrantup-03aae2a8.js" tppabs="http://docs.vagrantup.com/javascripts/vagrantup-03aae2a8.js" type="text/javascript"></script>

		<!-- fonts -->
		<link href="../../../fonts.googleapis.com/css-family=Inconsolata.css" tppabs="http://fonts.googleapis.com/css?family=Inconsolata" rel='stylesheet' type='text/css'>
		<script type="text/javascript" src="../../../use.typekit.net/xfs6zus.js" tppabs="http://use.typekit.net/xfs6zus.js"></script>
		<script type="text/javascript">try{Typekit.load();}catch(e){}</script>

		<!-- Google analytics -->
		<script type="text/javascript">

			var _gaq = _gaq || [];
			_gaq.push(['_setAccount', 'UA-15091924-1']);
			_gaq.push(['_trackPageview']);

			(function() {
			 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www/') + '.google-analytics.com/ga.js';
			 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
			 })();

		 </script>
	</head>
	<body>
		<!-- wrap everything -->
		<div class="wrapper">

			<!-- nav -->

			<nav class="docs">
			<!-- vagrant logo -->
			<a class="vagrant-docs-logo" href="javascript:if(confirm(%27https://docs.vagrantup.com/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed using an unsupported protocol (e.g., gopher).  \n\nDo you want to open it from the server?%27))window.location=%27https://docs.vagrantup.com/%27" tppabs="http://docs.vagrantup.com/">Vagrant Documentation</a>
			<!-- nav -->
			<ul class="pull-right unstyled">
				<li class="pill">
					<a href="javascript:if(confirm(%27http://www.amazon.com/gp/product/1449335837/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=1449335837&linkCode=as2&tag=vagrant-20  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.amazon.com/gp/product/1449335837/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=1449335837&linkCode=as2&tag=vagrant-20%27" tppabs="http://www.amazon.com/gp/product/1449335837/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=1449335837&linkCode=as2&tag=vagrant-20">
						Vagrant Book
					</a>
				</li>
				<li><a href="javascript:if(confirm(%27http://www.vagrantup.com/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.vagrantup.com/%27" tppabs="http://www.vagrantup.com/">Home</a></li>
			</ul>
			</nav>

			<div class="page docs docs-home">
				<div class="container">
					<div class="row">

						<div class="sidebar span3">
							<!-- get the sidebar nav -->
							<!-- side nav docs -->
							<aside class="sidebar-nav">

							<div class="toggle hidden-desktop">
								<div class="open-close open"></div>
								<a href="#">Contents</a>
							</div>

							<ul class="unstyled">
								<li><a href="../index.html" tppabs="http://docs.vagrantup.com/v2/">Overview</a></li>

								<li><a href="../why-vagrant/index.html" tppabs="http://docs.vagrantup.com/v2/why-vagrant/index.html">Why Vagrant?</a></li>

								<li><a href="../installation/index.html" tppabs="http://docs.vagrantup.com/v2/installation/index.html">Installation</a></li>
								

								<li><a href="../getting-started/index.html" tppabs="http://docs.vagrantup.com/v2/getting-started/index.html">Getting Started</a></li>
								

								<li><a href="../cli/index.html" tppabs="http://docs.vagrantup.com/v2/cli/index.html">Command-Line Interface</a></li>
								

								<li ><a href="../share/index.html" tppabs="http://docs.vagrantup.com/v2/share/index.html">Vagrant Share</a></li>
								

								<li ><a href="../vagrantfile/index.html" tppabs="http://docs.vagrantup.com/v2/vagrantfile/index.html">Vagrantfile</a></li>
								

								<li><a href="../boxes.html" tppabs="http://docs.vagrantup.com/v2/boxes.html">Boxes</a></li>
								

								<li><a href="../provisioning/index.html" tppabs="http://docs.vagrantup.com/v2/provisioning/index.html">Provisioning</a></li>
								

								<li><a href="../networking/index.html" tppabs="http://docs.vagrantup.com/v2/networking/index.html">Networking</a></li>
								

								<li><a href="../synced-folders/index.html" tppabs="http://docs.vagrantup.com/v2/synced-folders/index.html">Synced Folders</a></li>
								

								<li><a href="../multi-machine/index.html" tppabs="http://docs.vagrantup.com/v2/multi-machine/index.html">Multi-Machine</a></li>

								<li><a href="../providers/index.html" tppabs="http://docs.vagrantup.com/v2/providers/index.html">Providers</a></li>
								

								

								

								
								<li class="current"><a href="index.html" tppabs="http://docs.vagrantup.com/v2/vmware/index.html">VMware</a></li>
								
								<ul class="sub unstyled">
									<li><a href="installation.html" tppabs="http://docs.vagrantup.com/v2/vmware/installation.html">Installation</a></li>
									<li><a href="usage.html" tppabs="http://docs.vagrantup.com/v2/vmware/usage.html">Usage</a></li>
									<li><a href="boxes.html" tppabs="http://docs.vagrantup.com/v2/vmware/boxes.html">Boxes</a></li>
									<li><a href="configuration.html" tppabs="http://docs.vagrantup.com/v2/vmware/configuration.html">Configuration</a></li>
									<li><a href="known-issues.html" tppabs="http://docs.vagrantup.com/v2/vmware/known-issues.html">Known Issues</a></li>
									<li class="current"><a href="kernel-upgrade.html" tppabs="http://docs.vagrantup.com/v2/vmware/kernel-upgrade.html">Kernel Upgrade</a></li>
								</ul>
								
								

								

								<li><a href="../plugins/index.html" tppabs="http://docs.vagrantup.com/v2/plugins/index.html">Plugins</a></li>
								

								<li><a href="../push/index.html" tppabs="http://docs.vagrantup.com/v2/push/index.html">Push</a></li>

								

								<li><a href="../other/index.html" tppabs="http://docs.vagrantup.com/v2/other/index.html">Other</a></li>

								
							</ul>
							</aside> <!-- /.sidebar -->
						</div> <!-- /.sidebar -->

						<div class="page-contents span9">
							<div class="page-background"></div>

							<!-- start page content -->
							<div class="row">
								<div class="span8 offset1">
									<h1>Kernel Upgrade</h1>

<p>If as part of running your Vagrant environment with VMware, you perform
a kernel upgrade, it is likely that the VMware guest tools will stop working.
This breaks features of Vagrant such as synced folders and sometimes
networking as well.</p>

<p>This page documents how to upgrade your kernel and keep your guest tools
functioning. If you&#39;re not planning to upgrade your kernel, then you can safely
skip this page.</p>

<h2>Enable Auto-Upgrade of VMware Tools</h2>

<p>If you&#39;re running a common OS, VMware tools can often auto-upgrade themselves.
This setting is disabled by default. The Vagrantfile settings below will
enable auto-upgrading:</p>

<pre><code class="ruby"># Ensure that VMWare Tools recompiles kernel modules
# when we update the linux images
$fix_vmware_tools_script = &lt;&lt;SCRIPT
sed -i.bak &#39;s/answer AUTO_KMODS_ENABLED_ANSWER no/answer AUTO_KMODS_ENABLED_ANSWER yes/g&#39; /etc/vmware-tools/locations
sed -i.bak &#39;s/answer AUTO_KMODS_ENABLED no/answer AUTO_KMODS_ENABLED yes/g&#39; /etc/vmware-tools/locations
SCRIPT

Vagrant.configure(2) do |config|
  # ...

  config.vm.provision &quot;shell&quot;, inline: $fix_vmware_tools_script
end
</code></pre>

<p>Note that this doesn&#39;t work for every OS, so <code>vagrant up</code> with the above
settings, do a kernel upgrade, and do a <code>vagrant reload</code>. If HGFS (synced
folders) and everything appears to be working, great! If not, then read on...</p>

<h2>Manually Reinstalling VMware Tools</h2>

<p>At this point, you&#39;ll have to manually reinstall VMware tools. The best
source of information for how to do this is the
<a href="javascript:if(confirm(%27http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=1018414  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=1018414%27" tppabs="http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=1018414">VMware documentation</a>.</p>

<p>There are some gotchas:</p>

<ul>
<li><p>Make sure you have the kernel headers properly installed. This varies
by distro but is generally a package available via the package manager.</p></li>
<li><p>Watch the installation output carefully. Even if HGFS (synced folders)
support failed to build, the installer will output that installing VMware
tools was successful. Read the output to find any error messages.</p></li>
</ul>

								</div> <!-- /.span8 -->
							</div> <!-- /.row -->
						</div> <!-- /.page-contents -->
					</div> <!-- /.row -->
				</div> <!-- /.container -->
			</div> <!-- /.page -->

			<!-- footer -->
			<footer>
			<div class="container">
				<div class="row">
					<div class="span12">

						<ul class="unstyled footer-nav">
							<li><a href="javascript:if(confirm(%27https://docs.vagrantup.com/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed using an unsupported protocol (e.g., gopher).  \n\nDo you want to open it from the server?%27))window.location=%27https://docs.vagrantup.com/%27" tppabs="http://docs.vagrantup.com/">Documentation</a></li>
							<li><a href="javascript:if(confirm(%27http://www.vagrantup.com/about  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.vagrantup.com/about%27" tppabs="http://www.vagrantup.com/about">About</a></li>
							<li><a href="javascript:if(confirm(%27http://www.vagrantup.com/support  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.vagrantup.com/support%27" tppabs="http://www.vagrantup.com/support">Support</a></li>
							<a href="javascript:if(confirm(%27http://www.vagrantup.com/downloads  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.vagrantup.com/downloads%27" tppabs="http://www.vagrantup.com/downloads">
								<li class="button inline-button">Download</li>
							</a>
						</ul>

						<ul class="unstyled logos">
							<a href="javascript:if(confirm(%27http://www.vagrantup.com/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.vagrantup.com/%27" tppabs="http://www.vagrantup.com/">
								<li class="vagrant-logo-monochrome"></li>
							</a>
							<li><span>by</span></li>
							<a href="javascript:if(confirm(%27http://www.hashicorp.com/  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?%27))window.location=%27http://www.hashicorp.com/%27" tppabs="http://www.hashicorp.com/">
								<li class="hashi-logo-monochrome "></li>
							</a>
						</ul> <!-- /span -->

					</div> <!-- /span -->
				</div> <!-- /row -->

				<div class="row">
					<h6 class="legal">
						Copyright &copy; 2015 HashiCorp
					</h6>
				</div> <!-- row -->
			</div> <!-- container -->
			</footer>

			<!-- close .wrapper -->
		</div>

		<!-- load scripts -->
		<!-- load full-width image into any div with class="big-background -->
		<script>
			$(".big-background").backstretch("assets/photos/full_width.jpg"/*tpa=http://docs.vagrantup.com/v2/vmware/assets/photos/full_width.jpg*/);
		</script>
	</body>
</html>
